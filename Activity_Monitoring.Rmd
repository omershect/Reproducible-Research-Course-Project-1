---
title: "Reproducible Research: Course Project 1"
Author:
        "Omer Shechter"
Date:
        "20/09/2018"
output: 
  html_document:
    keep_md: true
---
## Data Loading
Download the files and unzip them into a data directory 
Check if data directory exist, if not create it
Than download the data and unzip it if not allredy exist
Read the Dataset into a datframe - Activity_DF
```{r}
if(!file.exists("data")) {  
        dir.create("data")  
}  
if(!file.exists("./data/Activity.zip")) {  
        fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"  
        download.file(fileUrl, destfile="./data/Activity.zip")  
        if(file.exists("./data/Activity.zip"))   
                unzip("./data/Activity.zip",exdir="./data")  
}
Activity_DF<-read.csv("./data/Activity.csv",sep = ",")
```


## First look at the dataset

```{r}
str(Activity_DF)
#Show only the non missing values in steps 
head(Activity_DF[which(!is.na(Activity_DF$steps)), ])
summary(Activity_DF)
```


## What is mean total number of steps taken per day?


Group the number of steps by date and intervals. 
Find the total number of steps per day over all days. 
some of the days have no steps data. 
This will be not shwon in the plot.

```{r}
#Create a dataframe with  total steps per day  and dates
Steps_Per_Day<-data.frame(date = unique(as.Date(Activity_DF$date,"%Y-%m-%d")), Total.Steps = tapply(Activity_DF$steps,as.Date(Activity_DF$date,"%Y-%m-%d"),sum))

head(Steps_Per_Day)
```

Plot the Histogram of the total steps per day (without NA values).
```{r Histogram Plot}
##Load ggplot2
library(ggplot2)

#Plot the Histogram (Remove missing values)
theme_update(plot.title = element_text(hjust = 0.5))
hist_NA_removed<-ggplot(data=na.omit(Steps_Per_Day),aes(Total.Steps))+geom_histogram(bins=10,colour='black', fill='red',binwidth = 900)+ggtitle("Histogram \n Total Steps per day (NA Removed)")+labs(x = "Steps",y = "Count")
hist_NA_removed

```



Calculate the mean and median per day.
```{r}
#Add the mean and median steps per day to the Steps_Per_Day
Steps_Per_Day<-cbind(Steps_Per_Day,data.frame(Steps.mean = tapply(Activity_DF$steps,as.Date(Activity_DF$date,"%Y-%m-%d"),mean)))

Steps_Per_Day<-cbind(Steps_Per_Day,data.frame(Steps.median = tapply(Activity_DF$steps,as.Date(Activity_DF$date,"%Y-%m-%d"),median)))
head(Steps_Per_Day)

```

## What is the average daily activity pattern?

Calculate the averge steps per interval.
```{r}
#Calculate the averge steps per interval (NA Remove)
Steps_Per_Interval<-aggregate(Activity_DF$steps, 
                       by=list(Activity_DF$interval), 
                       FUN=mean, 
                       na.rm=TRUE)
#calculate The 5-minute interval that, on average, holds the maximum number of steps
sprintf("The 5-minutes interval that, on average, holds the maximum number of steps is: %i",Steps_Per_Interval[which.max(Steps_Per_Interval$x), ]$Group.1)


```

Time series plot of the average number of steps taken using ggplot. 
```{r}
#Load ggplot2
library(ggplot2)
#plot a time serial of the avaarge number of stesp (withot missing values)
ggplot(data=Steps_Per_Interval,aes(y=x,x=Group.1))+geom_line(colour="blue",size=1)+labs(y="Avarage number of steps",x = "Interval in minutes", title = "Time series of the average number of steps taken (NA Removed)")

```



## Imputing missing values
This data set contain some dyas which are data is missing.
Calculate what is the amountof data mising and what is the percantage.
```{r}
#overall NA Samples
NA_count <- sum(is.na(Activity_DF$steps))
#Precentage of missing data 
NA_Precentage<-sum(is.na(Activity_DF$steps)) /length(Activity_DF$steps) * 100
sprintf("Overall Steps Data misiing is %f in Precentage %f%%",NA_count,NA_Precentage)
```

The amount of the missing data is not negligible.  
In order to overcome the NA values will be replaced by the mean value per day.
```{r}
#calaculate the positin of the NA values 
NA_Vector_Pos<-which(is.na(Activity_DF$steps))
#Create avector of the means
Mean_Vector <- rep(mean(Activity_DF$steps, na.rm=TRUE), times=length(NA_Vector_Pos))
#Copy the orignal Data frame to a new one
Activity_DF_NO_NA<-Activity_DF
#replace all NA values with the means values per day 
Activity_DF_NO_NA[NA_Vector_Pos, "steps"] <- Mean_Vector

head(Activity_DF_NO_NA)


```



Calculate and Plot again the total sum of the steps per day after handling the NA values 

```{r}
#Create a dataframe with  total steps per day  and dates
Steps_Per_Day_NA_Handled<-data.frame(date = unique(as.Date(Activity_DF_NO_NA$date,"%Y-%m-%d")), Total.Steps.NA.Handled = tapply(Activity_DF_NO_NA$steps,as.Date(Activity_DF$date,"%Y-%m-%d"),sum))

head(Steps_Per_Day_NA_Handled)
```

Plot the Histogram of the total steps per day (Including NA values).
```{r}
##Load ggplot2
library(ggplot2)

#Plot the Histogram (This time with the NA replaced by mean values)

hist_NA_Handled<-ggplot(data=Steps_Per_Day_NA_Handled,aes(Total.Steps.NA.Handled))+geom_histogram(bins=10,colour='black', fill='red',binwidth = 900)+ggtitle("Histogram \nTotal Steps per day (NA Handled)")+labs(x = "Steps",y = "Count")
hist_NA_Handled
```


Now plot the two Histogrhams side by side : 
1. With Mising values removed 
2. With missing values replaced by mean values 
```{r}
#Plot the two Histograms
gridExtra::grid.arrange(hist_NA_removed, hist_NA_Handled, nrow = 1)
```


## Are there differences in activity patterns between weekdays and weekends?
Using the modyfied Dataframe (with handled NA values) : 
Convert the dates from Factor to date
Set a new column which indicate if the sample is week days or weekend
Do some summary calculation 
Plot the activtes per 5 minutes interval according to the week or weekend days 



```{r results='asis', echo=FALSE, include=FALSE,}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
#Load library dplye

library(dplyr)
library(mosaic)
#Using English week days ...
Sys.setlocale("LC_TIME", "C")
```


```{r}
#Convert the Date colomn from Charcter to date format
Activity_DF_NO_NA$date<-as.Date(Activity_DF_NO_NA$date,"%Y-%m-%d")
#Create new Columns holding the week day name
Activity_DF_NO_NA<-mutate(Activity_DF_NO_NA,Week.Days=weekdays(Activity_DF_NO_NA$date))
#Create a colomns weekend  1 - Weekend (Saturday or Sunday) , 0 rest of the week days 
Activity_DF_NO_NA<-mutate(Activity_DF_NO_NA,Week.end=derivedFactor("1" = (Activity_DF_NO_NA$Week.Days == "Sunday") | Activity_DF_NO_NA$Week.Days == "Saturday",.default = 0))
head(Activity_DF_NO_NA)


```


